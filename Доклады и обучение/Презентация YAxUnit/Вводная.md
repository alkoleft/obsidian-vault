Расскажу вам про  модульное тестирование решений на платформе 1с.

В 1с существует несколько видов тестирования
1. Сценарное
2. Модульное
3. С помощью тестировщиков
4. С помощью заказчика

Сценарное и модульное это автоматическое тестирование, те кто-то пишет тесты, а потом они могут автоматические запускаться в CI, что позволяет снизить затраты на регрессе и повысить качество продукта. Эти тесты в основном проверяют что новые доработки не сломали существующую функциональность.

Исторически сложилось что для сценарного тестирования используется VA, а сценариии, тесты для нее пишут тестироващики, QA инженеры.

А вот модульными тестами занимаются разработчики при реализации своих задач.
Сейчас на разработки модульных тестов используется тестовый движок YAxUnit, разработанный в нашей компании.

Модульные тесты представляют из себя код 1с, который вызывает проверяемую функцию, подготавливает тестовые данные для ее корректной работы и проверяет результат.

Это позволяет быстро и точечно проверить функциональность конфигурации, работу различных методов.

Сравнение

| Критерий                 | Сценарные                                                                           | Модульные                                                    |     |
| ------------------------ | ----------------------------------------------------------------------------------- | ------------------------------------------------------------ | --- |
| Цель                     | Проверяют взаимодействие компонентов/частей системы, проверяют бизнес-процессы и тд | Проверяют, что части системы работают корректно              |     |
| Скорость выполнения      | На выполнение одного сценария требуется значительное время                          | Быстрые, порядка нескольких секунд на тест                   |     |
| Порог входа              | Низкий, можно просто прокликать и записать сценарий                                 | Сложность в подготовке данных                                |     |
| Поддержка и стабильность | Проверяется множество блоков системы, которые влияют и роняют тесты                 | Проверяются изолированные функции с минимальным воздействием |     |

Модульные тесты хорошо подходят для проверки
* Логики спрятанной от пользователя
	* Регламентные задания
	* Обмены
	* Интеграции с другими системами
* Сложной алгоритмической логики, требующей хорошего покрытия тестами. 
	* Тк тесты быстрые вы можете быстро прогнать большое их количество
	* Тесты это код, вы можете использовать все его возможность лв тестах: циклы, методы, повторное использование и тд

Модульные тесты и сценарные имеют разные цели и возможности, они не исключают друг друга. а дополняют.

Для повышения качества продукта вам придется внедрять и модульные и сценарные.

Вернемся к основной теме:

Для разработки модульных тестов для 1с у нас в компании используется YAxUnit, на текущий момент это лучший инструмент для юнитов, опубликованный в открытом доступе на github, который используют многие компании в своей разработке: авито, озон, леруа, первый бит и многие другие, даже разработчики вендора используют его в небольших проектах.

1. YaxUit это расширение конфигурации 1с и благодаря этому:
   1. Используется максимум возможностей платформы
   2. Имеется контекстная подсказка
   3. Отсутствует дублирование кода для клиента и сервера. А следовательно одинаковое поведение и там и там
2. Плагин для EDT, позволяющий с легкостью запускать и отлаживать тесты
3. Это молодой и живой проект с минимальным количеством легаси. Мы не боимся проводить рефакторинг и менять реализацию при необходимости, главное чтобы API и контракты оставались неизменными.
4. Мы следим за качеством продукта
   1. Стараемся придерживаться единого стиля API
   2. Большое внимание уделяется неймингу и удобству использования. Мы постарались сделать так, чтобы вы могли сосредоточится на написании теста и не тратили лишнего времени.
   3. Есть документация, тесты и ci.

## Функции движка
* Утверждения, для тех кто уже писал тесты, думаю они будут знакомы, за основу были взяты утверждения xUnitFor1C, которые перешли в ADD, VA и теперь в YaxUnit.
  Утверждения это способ описать и проверить свои ожидания от тестируемого метода. На всякий случай напомню, при тестировании мы опираемся не на код, а на требования к системе, на описания и контракты. Таким образом когда мы хотим протестировать код мы должны смотреть не на реализацию метода, а на его описание либо требования. Мы должны сформировать ожидания, что должно произойти если метод будет вызван определенным образом для определенных данных.
  С помощью утверждений мы описываем эти ожидания в тесте.
* Тестовые данные. Куда без них, код 1с очень тесно связан с данными хранящимися в БД. При тестировании нам часто понадобится создавать данные.
  Для облегчения подготовки тестовых данных было разработано несколько инструментов:
  
  * Генераторы случайных данных
  * Конструктор объекта
  * Загрузчик из макетов
  
  Здесь также хотел бы сделать акцент на то, что мы сторонники программного создания тестовых данных и заполнения их максимально случайными значениями. Подробнее о причинах такого подхода мы поговорим на одном из следующих занятиях. Добавлю лишь то, что за год публичной жизни никто не пожаловался на такой подход.
* Мокирование, эта фича на прошлом инфостарте сломала мозг многим 1сникам, но тут нет ничего магического и страшного, надо лишь понять, в чем я постараюсь помочь на одном из занятий.
  Основой является модуль Мокито, который был написан по образу одноименной библиотеки для java, он позволяет менять поведение системы прямо из теста. Например:
  * Подменить результат выполнения метода, предположим у вас есть интеграция с каким либо сервисом, с помощью Мокито вы можете без вызова этого сервиса вернуть нужный вам результат.
  * Позволяет отключать какие либо методы/проверки системы
  * Собирать и проверять статистику по вызовам методов
  * И многое другое, что сможете придумать
  
  Также есть API для тестирования http сервисов системы. В планах стоит тестирование soap, а дальше по потребностям.
* Есть различные методы помогаторы
* Плагин для запуска в EDT
* Обработка для запуска в 1С:Предприятии
Инструмент получился мощным и интересным. За прошедший год его взяли себе на вооружение многие компании, была инфа что в фирме 1с планируется обучение yaxunit. Пора и нам начать его использовать.

Организация тестирования:

Для БИА используется своя версия движка, в которую добавлены методы для тестирования обменов: сбор и разбор.

Также создано два репозитория, которые позволяют удобно обновлять YAxUnit используя гит в ваших проектах.

Сейчас тесты внедрены: БСП, селф сервис, РАТ, также потихоньку вкатываются ЛИСАД, ЦУП, немного в ГП, частично в ДЛТ, правда там только дымовые тесты.

Для того чтобы вам начать использовать его в своей работы необходимо:
* Изучить документацию, на ее основании вполне реально научиться пользоваться инструментом (ЛИСАД и ЦУП справились). Вы можете взять демо конфигурацию с github и попробовать покрыть некоторые методы тестами.
* Подключить yaxunit в свой проект (тут я помогу)
* Установить плаги для EDT
* Изучить рекомендации по тестированию (в документации): подход к наименованию модулей и методов, рекомендации к написанию тестов
* Для начала рекомендовал бы начать с простых, но полезных тестов, в которых вам не придется создавать много тестовых данных, например: обмены, как поступили в ЛИСАД, патчи методов БСП как в ЦУП. Для начала используйте небольшие методы с не очень сложной логикой и минимум объектов.
* А в дальнейшем по нарастающей.